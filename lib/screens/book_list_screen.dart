import 'dart:async';import 'package:flutter/material.dart';import 'package:provider/provider.dart';import 'package:shimmer/shimmer.dart';import '../providers/book_provider.dart';import '../widgets/custom_textfield.dart';class BookListScreen extends StatefulWidget {  const BookListScreen({super.key});  @override  State<BookListScreen> createState() => _BookListScreenState();}class _BookListScreenState extends State<BookListScreen> {  final ScrollController _scrollController = ScrollController();  final TextEditingController _searchController = TextEditingController();  Timer? _debounce;  @override  void initState() {    super.initState();    final bookProvider = Provider.of<BookProvider>(context, listen: false);    WidgetsBinding.instance.addPostFrameCallback((_) {      bookProvider.fetchInitialBooks();    });    _scrollController.addListener(() {      if (_scrollController.position.pixels ==          _scrollController.position.maxScrollExtent) {        bookProvider.loadMoreBooks();      }    });  }  @override  void dispose() {    _scrollController.dispose();    _searchController.dispose();    _debounce?.cancel();    super.dispose();  }  void _onSearchChanged(String query) {    if (_debounce?.isActive ?? false) _debounce!.cancel();    _debounce = Timer(const Duration(milliseconds: 500), () {      if (query.isNotEmpty) {        Provider.of<BookProvider>(context, listen: false).searchBooks(query);      }    });  }  Future<void> _onRefresh() async {    final bookProvider = Provider.of<BookProvider>(context, listen: false);    await bookProvider.fetchInitialBooks();  }  Widget _buildShimmerEffect() {    return Shimmer.fromColors(      baseColor: Colors.grey[300]!,      highlightColor: Colors.grey[100]!,      child: ListView.builder(        itemCount: 10,        itemBuilder: (context, index) {          return Card(            margin: const EdgeInsets.symmetric(horizontal: 8.0, vertical: 4.0),            child: ListTile(              leading: Container(width: 50, height: 50, color: Colors.white),              title: Container(                height: 16,                width: double.infinity,                color: Colors.white,              ),              subtitle: Container(                height: 14,                width: double.infinity,                color: Colors.white,                margin: const EdgeInsets.only(top: 8.0),              ),            ),          );        },      ),    );  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        title: const Text('Flutter Books'),      ),      body: Column(        children: [          Padding(            padding: const EdgeInsets.all(8.0),            child: CustomTextField(              controller: _searchController,              hintText: 'Search books...',              prefixIcon: Icons.search,              onChanged: _onSearchChanged,              onSubmitted: (query) {                if (_debounce?.isActive ?? false) _debounce!.cancel();                Provider.of<BookProvider>(context, listen: false)                    .searchBooks(query);              },            ),          ),          Expanded(            child: RefreshIndicator(              onRefresh: _onRefresh,              child: Consumer<BookProvider>(                builder: (context, provider, child) {                  if (provider.isLoading && provider.books.isEmpty) {                    return _buildShimmerEffect();                  }                  if (provider.error != null && provider.books.isEmpty) {                    return Center(                      child: Text('Error: ${provider.error}'),                    );                  }                  if (provider.books.isEmpty) {                    return const Center(                      child: Text('No books found.'),                    );                  }                  return ListView.builder(                    controller: _scrollController,                    itemCount: provider.books.length + (provider.hasMore ? 1 : 0),                    itemBuilder: (context, index) {                      if (index == provider.books.length) {                        return const Center(child: CircularProgressIndicator());                      }                      final book = provider.books[index];                      return Card(                        color: Colors.green[100],                        margin: const EdgeInsets.symmetric(                            horizontal: 8.0, vertical: 4.0),                        child: ListTile(                          leading: book.thumbnail != null                              ? Image.network(                                  book.thumbnail!,                                  width: 50,                                  fit: BoxFit.cover,                                )                              : const Icon(Icons.book, size: 50),                          title: Text(book.title),                          subtitle: Text(book.authors.join(', ')),                        ),                      );                    },                  );                },              ),            ),          ),        ],      ),    );  }}